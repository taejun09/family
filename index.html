<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title id="page-title">ìš°ë¦¬ê°€ì¡± | ìƒì¼ ì¶•í•˜ í˜ì´ì§€</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <link href="https://cdn.jsdelivr.net/gh/toss/tossface/dist/tossface.css" rel="stylesheet" type="text/css" />
  <link rel="icon" type="image/png" href="/img/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/img/favicon.svg" />
  <link rel="shortcut icon" href="/img/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png" />
  <link rel="manifest" href="/img/site.webmanifest" />

  <style>
    body {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    .tossface { font-family: Tossface; font-size: 1.5rem; }
    @font-face {
      font-family: 'IM_Hyemin-Bold';
      src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2106@1.1/IM_Hyemin-Bold.woff2') format('woff');
      font-weight: normal; font-style: normal;
    }
    html, body {
      font-size: 18px;
      font-family: IM_Hyemin-Bold;
      height: 100%; margin: 0; padding: 0;
    }
    body {
      background-image: radial-gradient(circle, #fff7f0 1px, transparent 1px);
      background-size: 20px 20px;
    }
    .balloon {
      position: absolute; animation: float 6s ease-in-out infinite;
      font-size: 2rem; z-index: 0;
    }
    @keyframes float {
      0% { transform: translateY(100vh) translateX(0); opacity: 0; }
      30% { opacity: 1; }
      100% { transform: translateY(-20vh) translateX(20px); opacity: 0; }
    }
  </style>
</head>
<body class="min-h-full p-6 flex flex-col items-center text-gray-800 relative">

  <!-- ğŸˆ í’ì„  ì• ë‹ˆë©”ì´ì…˜ -->
  <div class="balloon left-[10%] delay-[0s]"><span class="tossface text-4xl">ğŸˆ</span></div>
  <div class="balloon left-[40%] delay-[1s]"><span class="tossface">ğŸˆ</span></div>
  <div class="balloon left-[70%] delay-[2s]"><span class="tossface">ğŸˆ</span></div>

  <!-- ğŸµ ë°°ê²½ìŒì•… -->
  <audio id="bg-music" autoplay muted loop>
    <source src="/happy-birthday-357371.mp3" type="audio/mpeg">
    ë¸Œë¼ìš°ì €ê°€ ì˜¤ë””ì˜¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
  </audio>

  <h2 class="text-xl sm:text-2xl text-gray-600 mb-2 text-center">ì˜¤ëŠ˜ì€ ëˆ„êµ¬ì˜ ìƒì¼ì¼ê¹Œìš”?</h2>
  <h1 id="celebration-message" class="text-3xl sm:text-4xl font-semibold text-pink-600 mb-4 hidden text-center"></h1>

  <div class="w-full max-w-2xl space-y-6 z-10" id="card-list"></div>

  <div class="h-24"></div>

  <footer class="w-full mt-12 pt-8 border-t text-center text-sm text-gray-500">
    <p class="mb-1">ğŸ‚ í•¨ê»˜ì—¬ì„œ ë” í–‰ë³µí•œ ìš°ë¦¬ ê°€ì¡± ğŸ‚</p>
    <p class="mb-2">Â© 2025 KIM TAEJUN All rights reserved.</p>
    <p class="text-xs text-gray-400">made with ğŸ’› by Family and KIM TAEJUN</p>
  </footer>

  <!-- âœ… ìì²´ íŒì—… -->
  <div id="app-popup" class="fixed inset-0 hidden items-center justify-center z-50">
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="relative bg-white rounded-2xl shadow-xl max-w-md w-[90%] p-6 text-center">
      <h3 id="popup-title" class="text-2xl font-semibold mb-2">ì•Œë¦¼</h3>
      <p id="popup-message" class="text-gray-700 leading-relaxed">ë©”ì‹œì§€</p>
      <button id="popup-close" class="mt-6 px-5 py-2.5 rounded-full bg-pink-500 hover:bg-pink-600 text-white font-medium w-full">í™•ì¸</button>
    </div>
  </div>

  <script>
    // ===== ì„¤ì • =====
    const PASSWORD = '96510';
    const STORAGE_KEY = 'birthdayPageLastAccess';
    const ACCESS_DURATION = 7 * 24 * 60 * 60 * 1000;
    const DISCORD_WEBHOOK_URL = 'https://discord.com/api/webhooks/1408447744971898951/nhjFUcbV9J7CT_raMgZQnHJ05Vk9IicVEvhLBxlIoEUS_geyw8ddW664t7zykNOmDwar';

    // ===== ìœ í‹¸: íŒì—… =====
    function showPopup(title, message) {
      const popup = document.getElementById('app-popup');
      document.getElementById('popup-title').textContent = title;
      document.getElementById('popup-message').textContent = message;
      popup.classList.remove('hidden');
      popup.classList.add('flex');
    }
    function hidePopup() {
      const popup = document.getElementById('app-popup');
      popup.classList.add('hidden');
      popup.classList.remove('flex');
    }
    document.getElementById('popup-close').addEventListener('click', hidePopup);

    // ===== ì ‘ê·¼ ì œì–´ =====
    function isAccessValid() {
      const lastAccess = localStorage.getItem(STORAGE_KEY);
      if (!lastAccess) return false;
      const lastTime = parseInt(lastAccess, 10);
      return (Date.now() - lastTime) < ACCESS_DURATION;
    }

    async function askPassword() {
      return new Promise((resolve) => {
        let attempts = 3;
        function promptPassword() {
          const input = prompt('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (3íšŒ ê¸°íšŒ)');
          if (input === null) { resolve(false); return; }
          if (input === PASSWORD) { resolve(true); }
          else {
            attempts--;
            if (attempts > 0) {
              alert(`ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤. ${attempts}íšŒ ë‚¨ìŒ.`);
              promptPassword();
            } else {
              alert('ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ íšŸìˆ˜ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.');
              resolve(false);
            }
          }
        }
        promptPassword();
      });
    }

    async function checkAccess() {
      if (isAccessValid()) {
        initPage();
      } else {
        const ok = await askPassword();
        if (ok) {
          localStorage.setItem(STORAGE_KEY, Date.now().toString());
          initPage();
        } else {
          document.body.innerHTML = '<h2 class="text-center mt-20 text-xl text-red-600">ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.</h2>';
        }
      }
    }

    // ===== ë””ìŠ¤ì½”ë“œ ì›¹í›… ì „ì†¡ =====
    async function sendGiftRequestToDiscord(name) {
  const payload = {
    username: 'Birthday Bot',
    content: `<@1401891737642733679>`,
    embeds: [{
      title: 'ğŸ ì„ ë¬¼ ë°œì†¡ ìš”ì²­',
      description: `1ì¼ ì´ë‚´ ${name}ë‹˜ê»˜ ì„ ë¬¼ì„ ë°œì†¡í•´ì£¼ì„¸ìš”.`,
      color: 16750848,
      timestamp: new Date().toISOString(),
      footer: { text: 'ìš°ë¦¬ê°€ì¡± ìƒì¼ í˜ì´ì§€' }
    }],
    allowed_mentions: { users: ["1401891737642733679"] }
  };

  const res = await fetch(DISCORD_WEBHOOK_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload),
  });

  if (!res.ok) {
    const text = await res.text().catch(()=> '');
    throw new Error(`Webhook ì‹¤íŒ¨ (${res.status}) ${text}`);
  }
}

    function initPage() {
      const birthdays = {
        'ê¹€ê·œí˜„': '09-13',
        'ì†¡ì¸ì •': '06-03',
        'ê¹€íƒœì¤€': '05-27',
        'ê¹€ì£¼ì˜': '10-01'
      };

      const today = new Date();
      const todayDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
      const cardList = document.getElementById('card-list');

      let birthdayTitleName = null;

      Object.entries(birthdays).forEach(([name, dateStr]) => {
        const [month, day] = dateStr.split('-').map(Number);
        const birthdayThisYear = new Date(today.getFullYear(), month - 1, day);

        let diffDays = Math.ceil((birthdayThisYear - todayDate) / (1000 * 60 * 60 * 24));
        let ddayText = '';
        let isToday = false;

        if (diffDays === 0) {
          ddayText = 'D-DAY ì…ë‹ˆë‹¤!';
          isToday = true;
          birthdayTitleName = name;
        } else if (diffDays < 0) {
          ddayText = 'ìƒì¼ì´ ì§€ë‚¬ì–´ìš”!';
        } else {
          ddayText = `ìƒì¼ê¹Œì§€ D-${diffDays} ë‚¨ì•˜ì–´ìš”!`;
        }

        const card = document.createElement('div');
        card.className = `rounded-2xl shadow p-8 flex items-center justify-between border transition-all duration-300 ${
          isToday ? 'bg-pink-100 border-pink-200' : 'bg-gray-200 border-gray-300'
        }`;

        card.innerHTML = `
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between w-full gap-2 sm:gap-0">
            <div>
              <p class="text-2xl font-semibold">${name}</p>
              <p class="text-lg text-gray-600 mt-1">${ddayText}</p>
            </div>
            <a
              href="#"
              class="gift-btn mt-2 sm:mt-0 px-5 py-3 rounded-full text-base font-medium transition text-center w-full sm:w-auto ${
                isToday ? 'bg-pink-400 hover:bg-pink-500 text-white' : 'bg-gray-400 text-white pointer-events-none'
              }"
              ${isToday ? '' : 'aria-disabled="true"'}
              data-name="${name}"
            >
              ì„ ë¬¼ê³¼ í¸ì§€ í™•ì¸í•˜ê¸°
            </a>
          </div>
        `;
        cardList.appendChild(card);

        // ì˜¤ëŠ˜ ìƒì¼ì¸ ê²½ìš° í´ë¦­ í•¸ë“¤ëŸ¬ ë¶€ì—¬
        if (isToday) {
          const btn = card.querySelector('.gift-btn');
          btn.addEventListener('click', async (e) => {
            e.preventDefault();
            if (btn.dataset.loading === '1') return; // ì¤‘ë³µ ë°©ì§€
            btn.dataset.loading = '1';
            btn.textContent = 'ìš”ì²­ ì „ì†¡ ì¤‘...';
            btn.classList.add('opacity-70', 'pointer-events-none');

            try {
              await sendGiftRequestToDiscord(name);

              // ì„±ê³µ íŒì—…
              showPopup(
                'ìš”ì²­ì´ ì „ì†¡ë˜ì—ˆì–´ìš”! ğŸ‰',
                '24ì‹œê°„ ì•ˆì— ì„ ë¬¼ì„ ë°›ì•„ ë³¼ ìˆ˜ ìˆì„ ê±°ì˜ˆìš”!'
              );

              // ë²„íŠ¼ ìƒíƒœ ê³ ì •
              btn.textContent = 'ìš”ì²­ ì™„ë£Œ';
            } catch (err) {
              console.error(err);
              // ì‹¤íŒ¨ íŒì—…
              showPopup(
                'ì „ì†¡ì— ì‹¤íŒ¨í–ˆì–´ìš” ğŸ˜¢',
                'ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.'
              );
              // ì¬ì‹œë„ ê°€ëŠ¥í•˜ë„ë¡ ë³µêµ¬
              btn.dataset.loading = '0';
              btn.textContent = 'ì„ ë¬¼ê³¼ í¸ì§€ í™•ì¸í•˜ê¸°';
              btn.classList.remove('opacity-70', 'pointer-events-none');
            }
          });

          // ì¶•í¬
          confetti({ particleCount: 200, spread: 160, origin: { y: 0.3 } });
        }
      });

      if (birthdayTitleName) {
        document.title = `ìš°ë¦¬ê°€ì¡± | To. ${birthdayTitleName}`;
        const messageElement = document.getElementById('celebration-message');
        messageElement.innerHTML = `${birthdayTitleName}ë‹˜ì˜ ìƒì¼ì„ ì§„ì‹¬ìœ¼ë¡œ ì¶•í•˜í•´ìš”! <span class="tossface">ğŸ‰</span>`;
        messageElement.classList.remove('hidden');
      }

      // ì˜¤ë””ì˜¤ ìë™ ì¬ìƒ í—ˆìš©
      window.addEventListener('DOMContentLoaded', () => {
        const music = document.getElementById('bg-music');
        music.muted = false;
        const playPromise = music.play();
        if (playPromise !== undefined) {
          playPromise.catch(() => {
            const playAudio = () => {
              music.muted = false;
              music.play().catch(() => {});
              document.removeEventListener('click', playAudio);
            };
            document.addEventListener('click', playAudio);
          });
        }
      });
    }

    checkAccess();
  </script>

  <script>
    document.addEventListener('dragstart', e => e.preventDefault());
    document.addEventListener('selectstart', e => e.preventDefault());
  </script>


<script>
  // ë¦¬ë””ë ‰íŠ¸ ì£¼ì†Œ
  const redirectURL = "https://example.com";

  // ìš°í´ë¦­ ë°©ì§€
  document.addEventListener("contextmenu", (e) => {
    e.preventDefault();
    location.href = redirectURL;
  });

  // F12 (ê°œë°œì ë„êµ¬ ì—´ê¸°) ê°ì§€
  window.addEventListener("keydown", (e) => {
    if (
      e.key === "F12" || 
      (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "J")) ||
      (e.ctrlKey && e.key === "U")
    ) {
      location.href = redirectURL;
    }
  });

  // ê°œë°œì ë„êµ¬ ì—´ê¸° ê°ì§€ (í¬ê¸° ì°¨ì´ í™œìš©)
  const devtoolsChecker = setInterval(() => {
    if (window.outerWidth - window.innerWidth > 160 || window.outerHeight - window.innerHeight > 160) {
      location.href = redirectURL;
    }
  }, 1000);

  // PC í™˜ê²½ì—ì„œ ì°½ í¬ê¸° ë³€ê²½ ê°ì§€ (ìµœì´ˆ ë„ˆë¹„ ê¸°ì–µ â†’ ë³€ê²½ë˜ë©´ ë¦¬ë‹¤ì´ë ‰íŠ¸)
  let initialWidth = window.innerWidth;
  window.addEventListener("resize", () => {
    const isPC = window.innerWidth > 768;
    if (isPC && window.innerWidth !== initialWidth) {
      location.href = redirectURL;
    }
  });
</script>
</body>
</html>